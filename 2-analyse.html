<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR" xml:lang="fr-FR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Funathon 2024 - Sujet 2 - Exploration des données issues de l’API de TravelTime</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style/custom_styles.css">
<meta property="og:title" content="Funathon 2024 - Sujet 2 - Exploration des données issues de l’API de TravelTime">
<meta property="og:description" content="Visualiser les émissions de C02 liées à une mesure de restriction de liaison aérienne relativement à des durées de trajets ferroviaires dans le cadre. L’étude portera sur les liaisons aériennes entre les 10 plus grandes agglomérations de la Métropole française. Elle permettra de quantifier et de localiser les émissions de C02 évitées avec des mesures hypothétiques d’interdictions de liaisons aériennes lorsqu’une alternative ferroviaire existe en moins de 3h30, 4h30, 5h30…">
<meta property="og:site_name" content="Funathon 2024 - Sujet 2">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Présentation du sujet</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./1-api.html"> 
<span class="menu-text">API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./2-analyse.html" aria-current="page"> 
<span class="menu-text">Analyse des données</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./3-dataviz.html"> 
<span class="menu-text">Datavisualisation</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/InseeFrLab/funathon2024_sujet1"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#récupération-des-coordonnées-des-villes-françaises" id="toc-récupération-des-coordonnées-des-villes-françaises" class="nav-link active" data-scroll-target="#récupération-des-coordonnées-des-villes-françaises"><span class="header-section-number">1</span> Récupération des coordonnées des villes françaises</a></li>
  <li><a href="#obtention-du-temps-de-transport-entre-2-villes" id="toc-obtention-du-temps-de-transport-entre-2-villes" class="nav-link" data-scroll-target="#obtention-du-temps-de-transport-entre-2-villes"><span class="header-section-number">2</span> Obtention du temps de transport entre 2 villes</a></li>
  <li><a href="#téléchargement-et-traitement-des-données-de-trafic-aérien-entre-deux-villes" id="toc-téléchargement-et-traitement-des-données-de-trafic-aérien-entre-deux-villes" class="nav-link" data-scroll-target="#téléchargement-et-traitement-des-données-de-trafic-aérien-entre-deux-villes"><span class="header-section-number">3</span> Téléchargement et traitement des données de trafic aérien entre deux villes</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/InseeFrLab/funathon2024_sujet1/edit/main/2-analyse.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/InseeFrLab/funathon2024_sujet1/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploration des données issues de l’API de TravelTime</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)
Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)
Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)
Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)
Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)
Warning in get_travel_time_api_response(ROUTES_API_URL, request_body): Failed
to retrieve data: Client error: (429) Too Many Requests (RFC 6585)</code></pre>
</div>
</div>
<section id="récupération-des-coordonnées-des-villes-françaises" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Récupération des coordonnées des villes françaises</h1>
<p>L’objectif de cette partie est de récupérer les coordonnées géographiques des gares françaises à partir d’une base de données disponible en accès ouvert sur <a href="https://www.data.gouv.fr/">data.gouv.fr</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Comment télécharger un CSV dans un programe R ?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Il suffit de copier-coller le lien de téléchargement d’un fichier CSV dans la fonction <code>read.csv</code> ou <code>read.csv2</code> (exemple : <code>read.csv("lien_de_téléchargement")</code>)</p>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 2 : Travailler avec des données géographiques
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Sur <a href="https://www.data.gouv.fr/">data.gouv.fr</a>, chercher le jeu de données correspondant à la liste des gare.</p></li>
<li><p>Importer le jeu de données au format csv dans votre console R, sans télécharger localement le fichier. Observer les données.</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit l'URL des données</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>STATIONS_DATA_URL <span class="ot">&lt;-</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/d22ba593-90a4-4725-977c-095d1f654d28"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>stations_data <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(STATIONS_DATA_URL)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Afficher les données
</summary>

<div class="cell" data-df-print="kable">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">code_uic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">libelle</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">fret</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">voyageurs</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">code_ligne</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rg_troncon</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pk</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">commune</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">departemen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">idreseau</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">idgaia</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">x_l93</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">y_l93</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">x_wgs84</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">y_wgs84</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">c_geo</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">geo_point_2d</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">geo_shape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">87009696</td>
<td style="text-align: left;">La Douzillère</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">O</td>
<td style="text-align: right;">594000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">244+100</td>
<td style="text-align: left;">JOUE-LES-TOURS</td>
<td style="text-align: left;">INDRE-ET-LOIRE</td>
<td style="text-align: right;">4650</td>
<td style="text-align: left;">d9dc0092-6667-11e3-89ff-01f464e0362d</td>
<td style="text-align: left;">522803.98640000075</td>
<td style="text-align: left;">6695781.5896000005</td>
<td style="text-align: left;">0.653001386682489</td>
<td style="text-align: left;">47.33866140621093</td>
<td style="text-align: left;">47.33866140621093, 0.6530013866824887</td>
<td style="text-align: left;">47.338661406198106, 0.6530013866824868</td>
<td style="text-align: left;">{"coordinates": [0.653001386682487, 47.338661406198106], "type": "Point"}</td>
</tr>
<tr class="even">
<td style="text-align: right;">87142554</td>
<td style="text-align: left;">Châtillon-sur-Seine</td>
<td style="text-align: left;">O</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">839000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">035+431</td>
<td style="text-align: left;">SAINTE-COLOMBE-SUR-SEINE</td>
<td style="text-align: left;">COTE-D'OR</td>
<td style="text-align: right;">9201</td>
<td style="text-align: left;">29d3de32-dfbc-11e3-a2ff-01a464e0362d</td>
<td style="text-align: left;">815990.5833000019</td>
<td style="text-align: left;">6753362.917800002</td>
<td style="text-align: left;">4.551565119152175</td>
<td style="text-align: left;">47.87040423667916</td>
<td style="text-align: left;">47.87040423667916, 4.551565119152175</td>
<td style="text-align: left;">47.87040423666789, 4.551565119152176</td>
<td style="text-align: left;">{"coordinates": [4.551565119152176, 47.87040423666789], "type": "Point"}</td>
</tr>
<tr class="odd">
<td style="text-align: right;">87382218</td>
<td style="text-align: left;">La Défense</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">O</td>
<td style="text-align: right;">973000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">008+295</td>
<td style="text-align: left;">PUTEAUX</td>
<td style="text-align: left;">HAUTS-DE-SEINE</td>
<td style="text-align: right;">4648</td>
<td style="text-align: left;">c0d4c69a-f312-11e3-90ff-015864e0362d</td>
<td style="text-align: left;">644164.1872999966</td>
<td style="text-align: left;">6866205.721500002</td>
<td style="text-align: left;">2.238471684534599</td>
<td style="text-align: left;">48.89343723770491</td>
<td style="text-align: left;">48.89343723770491, 2.2384716845345993</td>
<td style="text-align: left;">48.89343723768303, 2.2384716845345984</td>
<td style="text-align: left;">{"coordinates": [2.238471684534598, 48.89343723768303], "type": "Point"}</td>
</tr>
<tr class="even">
<td style="text-align: right;">87718122</td>
<td style="text-align: left;">Byans</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">O</td>
<td style="text-align: right;">871000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">015+118</td>
<td style="text-align: left;">BYANS-SUR-DOUBS</td>
<td style="text-align: left;">DOUBS</td>
<td style="text-align: right;">3446</td>
<td style="text-align: left;">297c8c1e-dfbc-11e3-a2ff-01a464e0362d</td>
<td style="text-align: left;">916198.4419</td>
<td style="text-align: left;">6672578.780099999</td>
<td style="text-align: left;">5.852088069196292</td>
<td style="text-align: left;">47.11832925172662</td>
<td style="text-align: left;">47.11832925172662, 5.852088069196292</td>
<td style="text-align: left;">47.11832925171314, 5.852088069196295</td>
<td style="text-align: left;">{"coordinates": [5.852088069196295, 47.11832925171314], "type": "Point"}</td>
</tr>
<tr class="odd">
<td style="text-align: right;">87721829</td>
<td style="text-align: left;">Chamelet</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">O</td>
<td style="text-align: right;">775000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">074+576</td>
<td style="text-align: left;">CHAMELET</td>
<td style="text-align: left;">RHONE</td>
<td style="text-align: right;">3578</td>
<td style="text-align: left;">d9cff2d6-6667-11e3-89ff-01f464e0362d</td>
<td style="text-align: left;">816664.1966999993</td>
<td style="text-align: left;">6543551.646000002</td>
<td style="text-align: left;">4.507016244543598</td>
<td style="text-align: left;">45.98167025804158</td>
<td style="text-align: left;">45.98167025804158, 4.507016244543598</td>
<td style="text-align: left;">45.98167025802479, 4.5070162445436</td>
<td style="text-align: left;">{"coordinates": [4.5070162445436, 45.98167025802479], "type": "Point"}</td>
</tr>
<tr class="even">
<td style="text-align: right;">87471060</td>
<td style="text-align: left;">L'Hermitage-Mordelles</td>
<td style="text-align: left;">O</td>
<td style="text-align: left;">O</td>
<td style="text-align: right;">420000</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">385+104</td>
<td style="text-align: left;">L'HERMITAGE</td>
<td style="text-align: left;">ILLE-ET-VILAINE</td>
<td style="text-align: right;">8893</td>
<td style="text-align: left;">e1934ea8-19bf-11e5-a6ff-01fc64e0362d</td>
<td style="text-align: left;">341644.2468999997</td>
<td style="text-align: left;">6791268.489999998</td>
<td style="text-align: left;">-1.81921151526776</td>
<td style="text-align: left;">48.123335774611554</td>
<td style="text-align: left;">48.123335774611554, -1.8192115152677604</td>
<td style="text-align: left;">48.123335774601024, -1.8192115152677635</td>
<td style="text-align: left;">{"coordinates": [-1.819211515267763, 48.123335774601024], "type": "Point"}</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</details>
<ol start="3" type="1">
<li>Utiliser cette base de données qui contient, entre autres, les coordonnées géographiques des gares françaises afin d’extraire un couple de coordonnées (latitude, longitude) à partir d’un nom de gare. Faire un test en affichant les coordonnées de la gare de Lille-Flandres.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>STATION_NAME <span class="ot">&lt;-</span> <span class="st">"Lille-Flandres"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> stations_data <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">lng =</span> x_wgs84, <span class="at">lat =</span> y_wgs84, libelle) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(libelle <span class="sc">==</span> STATION_NAME) <span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">lat =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="fu">as.numeric</span>(lat)), <span class="at">lng =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="fu">as.numeric</span>(lng))) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Encapsuler le code précédent dans une fonction renvoyant les coordonnées d’une gare à partir de la chaîne de caractère du nom de la gare. Faire un test en affichant les coordonnées de la gare de Toulouse-Matabiau.</li>
</ol>
<p>::::{.callout-warning} Dans le jeu de données des stations de France, le point géographique pour la gare de Strasbourg-Ville si situe au milieu des rails… point qui est considéré inatteignable pour l’API de TravelTime. Utiliser le point <span class="math inline">\((48.584488, 7.735626)\)</span> pour cette gare, qui correspond à l’entrée de la gare. ::::</p>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_station_coordinates <span class="ot">&lt;-</span> <span class="cf">function</span>(station, data, <span class="at">verbose =</span> <span class="cn">TRUE</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (station <span class="sc">!=</span> <span class="st">"Strasbourg-Ville"</span>) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    coords <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">lng =</span> x_wgs84, <span class="at">lat =</span> y_wgs84, libelle) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(libelle <span class="sc">==</span> station) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">lat =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="fu">as.numeric</span>(lat)), <span class="at">lng =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="fu">as.numeric</span>(lng))) <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    coords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">48.584488</span>, <span class="fl">7.735626</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Si verbose est TRUE, on affiche les coordonnées</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose){</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%s -&gt; (%f, %f)</span><span class="sc">\n</span><span class="st">"</span>, station, coords[<span class="dv">1</span>], coords[<span class="dv">2</span>]))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(coords)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>tlse_coords <span class="ot">&lt;-</span> <span class="fu">get_station_coordinates</span>(<span class="st">"Toulouse-Matabiau"</span>, stations_data, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Toulouse-Matabiau -&gt; (43.610699, 1.454396)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="obtention-du-temps-de-transport-entre-2-villes" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Obtention du temps de transport entre 2 villes</h1>
<p>L’objectif de cette partie est de récupérer le temps de transport entre deux gares à partir de leur nom en combinant la fonction <code>get_travel_time_api_response()</code> donnée dans la fonction <code>get_travel_time_api_response()</code> et la fonction <code>get_station_coordinates()</code>.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 3 : Calcul du temps de transport
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Créer une fonction qui prend en paramètres deux couples de coordonnées et qui renvoie un JSON (en chaine de caractère) destiné à l’API de routage. Utilisez ces paramètres par défaut dans votre corps de requête :</li>
</ol>
<ul>
<li>Lieu de départ : Variable (coords1)</li>
<li>Lieu d’arrivée : Variable (coords2)</li>
<li>Mode de transport : Transport public (bus, métro, tram, train)</li>
<li>Date et heure : 2024-06-05 à 18h00 UTC</li>
<li>Flexibilité : 12h00</li>
<li>Le reste des paramètres par défaut</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_routes_api_json <span class="ot">&lt;-</span> <span class="cf">function</span>(coords1, coords2){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On créé le JSON pour l'API de routage en se basant sur celui de la sous-partie "Interaction avec l'API de routage de TravelTime"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  request_body <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">'{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">    "locations": [</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">      {</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">        "id": "point-from",</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": {</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">          "lat": %f,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">          "lng": %f </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">      },</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">      {</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">        "id": "point-to-1",</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">        "coords": {</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">          "lat": %f,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">          "lng": %f </span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">    ],</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">    "departure_searches": [</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="st">      {</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">        "id": "departure-search",</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">        "transportation": {</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">          "type": "public_transport",</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="st">          "walking_time": 900,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="st">          "cycling_time_to_station": 100,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="st">          "parking_time": 0,</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">          "boarding_time": 0,</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="st">          "driving_time_to_station": 1800,</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="st">          "pt_change_delay": 0,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="st">          "disable_border_crossing": false</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="st">        "departure_location_id": "point-from",</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="st">        "arrival_location_ids": [</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="st">          "point-to-1"</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="st">        "departure_time": "2024-06-05T18:00:00.000Z",</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="st">        "properties": [</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="st">          "travel_time",</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="st">          "route"</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="st">        "range": {</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="st">          "enabled": true,</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="st">          "max_results": 5,</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="st">          "width": 43200</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="st">    ]</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="st">  }'</span> , coords1[<span class="dv">1</span>], coords1[<span class="dv">2</span>], coords2[<span class="dv">1</span>], coords2[<span class="dv">2</span>])</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(request_body)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>En utilisant la fonction précédement écrite, créer une fonction qui prend en paramètre deux noms de gares et qui renvoie le temps (en heure) de transport du trajet le plus court entre ces 2 gares. Il faudra prendre soin de gérer le cas où aucun trajet n’est trouvé en renvoyant <em>Inf</em>.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>get_travel_time_between_stations <span class="ot">&lt;-</span> <span class="cf">function</span>(station1, station2, data, <span class="at">verbose =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si les stations sont identiques aucun trajet nécessaire</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (station1 <span class="sc">==</span> station2) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Récupérer les coordonnées pour les deux stations</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  coordinates <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(station1, station2), get_station_coordinates, <span class="at">data =</span> data, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Générer le JSON pour l'API de routage</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  request_body <span class="ot">&lt;-</span> <span class="fu">get_routes_api_json</span>(coordinates[[<span class="dv">1</span>]], coordinates[[<span class="dv">2</span>]])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interroger l'API de routage</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">get_travel_time_api_response</span>(ROUTES_API_URL, request_body)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gérer la limitation du taux d'API</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response[[<span class="dv">2</span>]] <span class="sc">==</span> <span class="dv">429</span>) {</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verbose) <span class="fu">cat</span>(<span class="st">"Trop de requêtes, attente d'une minute...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">60</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">get_travel_time_between_stations</span>(station1, station2, data, verbose))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vérifier l'existence d'un itinéraire valide</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(response[[<span class="dv">1</span>]]<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>locations) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    travel_time <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraire les données de temps de trajet et trouver le temps de trajet minimum en heures</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    travel_times <span class="ot">&lt;-</span> <span class="fu">sapply</span>(response[[<span class="dv">1</span>]]<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>locations[[<span class="dv">1</span>]]<span class="sc">$</span>properties, <span class="cf">function</span>(item) item<span class="sc">$</span>travel_time)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    travel_time <span class="ot">&lt;-</span> <span class="fu">min</span>(travel_times) <span class="sc">/</span> <span class="dv">3600</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Afficher le temps de trajet si verbose</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    message_text <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%s -&gt; %s : %s heures</span><span class="sc">\n</span><span class="st">"</span>, station1, station2, <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(travel_time), <span class="st">"Aucun itinéraire trouvé"</span>, <span class="fu">round</span>(travel_time, <span class="dv">2</span>)))</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(message_text)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(travel_time)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Tester votre fonction avec Paris-Montparnasse et Toulouse-Matabiau.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>travel_time <span class="ot">&lt;-</span> <span class="fu">get_travel_time_between_stations</span>(<span class="st">"Paris-Montparnasse"</span>, <span class="st">"Toulouse-Matabiau"</span>, stations_data, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Paris-Montparnasse -&gt; Toulouse-Matabiau : 4.4 heures</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Faire une matrice temporelle des temps de trajet entre les gares des 10 plus grandes agglomérations françaises (on considerera que la matrice est symétrique pour la compléter plus rapidement). La liste des noms des gares principales (telle qu’écrite dans la base de données en opendata) des 10 plus grandes agglomérations françaises est la suivante : Paris-Nord, Lyon-Perrache, Marseille-St-Charles, Toulouse-Matabiau, Lille-Flandres, Bordeaux-St-Jean, Nice-Ville, Nantes, Strasbourg-Ville et Montpellier-St-Roch.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
L’API de routage de TravelTime a un quota de requêtes par minute
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si la fonction <code>get_travel_time_api_response()</code> donnée dans la partie 1 renvoie le code <strong>429</strong>, cela signifie que vous avez dépassé le quota de requêtes par minute. Dans ce cas, attendez une minute avec la fonction <code>Sys.sleep(60)</code> avant de relancer la fonction précédement écrite.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the stations</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>STATIONS <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Paris-Nord"</span>, <span class="st">"Lyon-Perrache"</span>, <span class="st">"Marseille-St-Charles"</span>, <span class="st">"Toulouse-Matabiau"</span>, <span class="st">"Lille-Flandres"</span>, <span class="st">"Bordeaux-St-Jean"</span>, <span class="st">"Nice-Ville"</span>, <span class="st">"Nantes"</span>, <span class="st">"Strasbourg-Ville"</span>, <span class="st">"Montpellier-St-Roch"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialisation de la matrice</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>time_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(STATIONS), <span class="at">ncol =</span> <span class="fu">length</span>(STATIONS), <span class="at">dimnames =</span> <span class="fu">list</span>(STATIONS, STATIONS))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On remplit la matrice avec toutes les pairs possibles</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">combn</span>(STATIONS, <span class="dv">2</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pair <span class="cf">in</span> combinations) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  travel_time <span class="ot">&lt;-</span> <span class="fu">get_travel_time_between_stations</span>(pair[<span class="dv">1</span>], pair[<span class="dv">2</span>], stations_data, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  time_matrix[pair[<span class="dv">1</span>], pair[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">round</span>(travel_time, <span class="dv">2</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  time_matrix[pair[<span class="dv">2</span>], pair[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">round</span>(travel_time, <span class="dv">2</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Afficher la matrice
</summary>

<div class="cell" data-df-print="kable">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Paris-Nord</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lyon-Perrache</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Marseille-St-Charles</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Toulouse-Matabiau</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lille-Flandres</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bordeaux-St-Jean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Nice-Ville</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Nantes</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Strasbourg-Ville</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Montpellier-St-Roch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Paris-Nord</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2.45</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">5.14</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">5.85</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">3.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lyon-Perrache</td>
<td style="text-align: right;">2.45</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2.16</td>
<td style="text-align: right;">4.75</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">5.05</td>
<td style="text-align: right;">4.91</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marseille-St-Charles</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">2.16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.94</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: right;">6.17</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">6.80</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.73</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toulouse-Matabiau</td>
<td style="text-align: right;">5.14</td>
<td style="text-align: right;">4.75</td>
<td style="text-align: right;">3.94</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">7.34</td>
<td style="text-align: right;">2.16</td>
<td style="text-align: right;">6.72</td>
<td style="text-align: right;">7.59</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lille-Flandres</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: right;">7.34</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">4.07</td>
<td style="text-align: right;">7.52</td>
<td style="text-align: right;">4.15</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">5.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bordeaux-St-Jean</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">6.17</td>
<td style="text-align: right;">2.16</td>
<td style="text-align: right;">4.07</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.51</td>
<td style="text-align: right;">3.89</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">4.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nice-Ville</td>
<td style="text-align: right;">5.85</td>
<td style="text-align: right;">5.05</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">6.72</td>
<td style="text-align: right;">7.52</td>
<td style="text-align: right;">9.51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">4.66</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nantes</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">4.91</td>
<td style="text-align: right;">6.80</td>
<td style="text-align: right;">7.59</td>
<td style="text-align: right;">4.15</td>
<td style="text-align: right;">3.89</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Strasbourg-Ville</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
</tr>
<tr class="even">
<td style="text-align: left;">Montpellier-St-Roch</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">2.05</td>
<td style="text-align: right;">1.73</td>
<td style="text-align: right;">2.24</td>
<td style="text-align: right;">5.04</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: right;">4.66</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</details>
<ol start="5" type="1">
<li>Créer une liste avec les couples des gares reliées par un temps de trajet inférieur à 4h30</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>THRESHOLD <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On garde seulement la matrice triangulaire inférieur (car on la supposé symmétrique)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>lower_tri_matrix <span class="ot">&lt;-</span> <span class="fu">lower.tri</span>(time_matrix)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On extrait les indices où la condition n'est pas respectée</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>under_threshold_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(time_matrix <span class="sc">&lt;</span> THRESHOLD <span class="sc">&amp;</span> lower_tri_matrix, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># On crée une liste de paires qui remplissent les conditions</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>under_threshold_routes <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(i, j) <span class="fu">c</span>(STATIONS[i], STATIONS[j]),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">i =</span> under_threshold_indices[, <span class="dv">1</span>],</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">j =</span> under_threshold_indices[, <span class="dv">2</span>],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                                 )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="téléchargement-et-traitement-des-données-de-trafic-aérien-entre-deux-villes" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Téléchargement et traitement des données de trafic aérien entre deux villes</h1>
<p>Cette partie du sujet consiste à télécharger et traiter des données de trafic aérien entre deux aéroports en 2019 pour calculer les émissions de CO2 du trafic aérien entre les couples de villes/de gares identifiés précédemment et d’en déduire les émissions de CO2 approximatives évitées avec des mesures hypothétiques d’interdictions de liaisons aériennes.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 4 : Analyse du trafic aérien
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Sur <a href="https://www.data.gouv.fr/">data.gouv.fr</a>, trouver le jeu de données correspondant au trafic aérien publié par la DGAC.</p></li>
<li><p>Importer le jeu de données au format csv de l’année 2019 dans votre console R, sans télécharger localement le fichier. Observer les données.</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit l'URL des données</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>AIR_TRAFFIC_DATA_URL <span class="ot">&lt;-</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/0c0a451e-983b-4f06-9627-b5ff1bccd2fc"</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>air_traffic_df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(AIR_TRAFFIC_DATA_URL)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Afficher les données
</summary>

<div class="cell" data-df-print="kable">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ANMOIS</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">LSN</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">LSN_DEP_NOM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">LSN_ARR_NOM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">LSN_SCT</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">LSN_FSC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_DIST</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_PEQ_loc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_PAX_loc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_FRP_loc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_VOL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_PAX_FS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_FRP_FS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_PEQ_FS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LSN_DRT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">BIKF_LFPG</td>
<td style="text-align: left;">REYKJAVIK/KEFLAVIK</td>
<td style="text-align: left;">PARIS-CHARLES DE GAULLE</td>
<td style="text-align: left;">MC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">2244</td>
<td style="text-align: right;">15606</td>
<td style="text-align: right;">12572</td>
<td style="text-align: right;">303.320</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">12528</td>
<td style="text-align: right;">303.320</td>
<td style="text-align: right;">15562</td>
<td style="text-align: right;">72</td>
</tr>
<tr class="even">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">BKPR_LFSB</td>
<td style="text-align: left;">PRISTINA</td>
<td style="text-align: left;">BALE-MULHOUSE</td>
<td style="text-align: left;">MC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">1198</td>
<td style="text-align: right;">15094</td>
<td style="text-align: right;">15087</td>
<td style="text-align: right;">0.733</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">15087</td>
<td style="text-align: right;">0.733</td>
<td style="text-align: right;">15094</td>
<td style="text-align: right;">98</td>
</tr>
<tr class="odd">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">CYUL_LFPG</td>
<td style="text-align: left;">MONTREAL-DORVAL</td>
<td style="text-align: left;">PARIS-CHARLES DE GAULLE</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">5530</td>
<td style="text-align: right;">47412</td>
<td style="text-align: right;">39347</td>
<td style="text-align: right;">806.508</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">38996</td>
<td style="text-align: right;">800.870</td>
<td style="text-align: right;">47005</td>
<td style="text-align: right;">118</td>
</tr>
<tr class="even">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">CYYZ_LFPG</td>
<td style="text-align: left;">TORONTO-PEARSON</td>
<td style="text-align: left;">PARIS-CHARLES DE GAULLE</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">6026</td>
<td style="text-align: right;">19002</td>
<td style="text-align: right;">14644</td>
<td style="text-align: right;">435.835</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">14644</td>
<td style="text-align: right;">435.835</td>
<td style="text-align: right;">19002</td>
<td style="text-align: right;">57</td>
</tr>
<tr class="odd">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">DAAG_LFML</td>
<td style="text-align: left;">ALGER</td>
<td style="text-align: left;">MARSEILLE-PROVENCE</td>
<td style="text-align: left;">MC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">770</td>
<td style="text-align: right;">14605</td>
<td style="text-align: right;">14451</td>
<td style="text-align: right;">15.276</td>
<td style="text-align: right;">162</td>
<td style="text-align: right;">14451</td>
<td style="text-align: right;">15.276</td>
<td style="text-align: right;">14605</td>
<td style="text-align: right;">163</td>
</tr>
<tr class="even">
<td style="text-align: right;">201901</td>
<td style="text-align: left;">DAAG_LFPG</td>
<td style="text-align: left;">ALGER</td>
<td style="text-align: left;">PARIS-CHARLES DE GAULLE</td>
<td style="text-align: left;">MC</td>
<td style="text-align: left;">MET_INTL</td>
<td style="text-align: right;">1373</td>
<td style="text-align: right;">37158</td>
<td style="text-align: right;">35158</td>
<td style="text-align: right;">199.998</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">35158</td>
<td style="text-align: right;">199.998</td>
<td style="text-align: right;">37158</td>
<td style="text-align: right;">287</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</details>
<ol start="3" type="1">
<li>Créer une fonction qui renvoie le trafic total d’une liaison en 2019 en PKT (produit du nombre de passagers et de la distance parcourue) à partir des deux noms de villes (et non d’aéroport) en paramètre.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Les noms des principaux aéroports de métropole contiennent le nom de la ville qu’il déssert.</li>
<li>Le nombre de passagers correspond à la variable <code>LSN_PAX_loc</code>.</li>
<li>N’oubliez pas de prendre en compte le trafic aérien dans les deux sens.</li>
<li>Paris qui possède 2 aéroports commerciaux</li>
</ol>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>get_air_traffic_between_cities <span class="ot">&lt;-</span> <span class="cf">function</span>(city1, city2, data) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcul du trafic dans les deux sens city1 -&gt; city2 et city2 -&gt; city1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  total_traffic <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">grepl</span>(city1, LSN_DEP_NOM, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> <span class="fu">grepl</span>(city2, LSN_ARR_NOM, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">|</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">grepl</span>(city2, LSN_DEP_NOM, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> <span class="fu">grepl</span>(city1, LSN_ARR_NOM, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">traffic =</span> <span class="fu">sum</span>(LSN_DIST <span class="sc">*</span> LSN_PAX_loc)) <span class="sc">|&gt;</span> <span class="co"># calcul du PKT</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(traffic)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.numeric</span>(total_traffic))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Tester la fonction avec Paris et Toulouse</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_air_traffic_between_cities</span>(<span class="st">"Paris"</span>, <span class="st">"Toulouse"</span>, air_traffic_df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1870474245</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Sommer le trafic aérien pour chaque couple de villes reliées par un temps de trajet inférieur à 4h30</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les noms des principales gares de métropole contiennent le nom de la ville qu’il déssert</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction pour extraire les noms des villes à partir des noms des gares</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>extract_city_name <span class="ot">&lt;-</span> <span class="cf">function</span>(station) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(station, <span class="cf">function</span>(x) <span class="fu">strsplit</span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les paires de villes </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>city_pairs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(under_threshold_routes, extract_city_name)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>under_threshold_air_traffic <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer le trafic aérien pour chaque paire</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pair <span class="cf">in</span> city_pairs) {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  air_traffic <span class="ot">&lt;-</span> <span class="fu">get_air_traffic_between_cities</span>(pair[<span class="dv">1</span>], pair[<span class="dv">2</span>], air_traffic_df)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  under_threshold_air_traffic <span class="ot">&lt;-</span> under_threshold_air_traffic <span class="sc">+</span> air_traffic</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>En déduire les émissions de CO2 approximatives évitées que représente ce trafic avec une estimation des gCO2éq par PKT de <a href="https://www.statista.com/statistics/1113177/co2-emissions-by-airline-europe/">statista</a></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Cliquer pour voir la réponse</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-overflow-scroll code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>GCO2_PER_PKT <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On estime les émissions de CO2 en tCO2éq</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"En 2019, environ %.2f gCO2éq aurait pu être évités"</span>, under_threshold_air_traffic <span class="sc">*</span> GCO2_PER_PKT <span class="sc">/</span> <span class="dv">1000000</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>En 2019, environ 213252.05 gCO2éq aurait pu être évités</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/inseefrlab\.github\.io\/funathon2024_sujet1\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/InseeFrLab/funathon2024_sujet1/edit/main/2-analyse.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/InseeFrLab/funathon2024_sujet1/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="./LICENCE">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>